$(document).ready(function(){var e=document.getElementsByClassName("needs-validation");Array.prototype.filter.call(e,function(o){o.addEventListener("submit",function(e){e.preventDefault(),e.stopPropagation(),o.classList.add("was-validated"),!0===o.checkValidity()&&function(){$(this).toggleClass("d-none"),$("#btn-sending").toggleClass("d-none"),$("#container-alerts").empty();var e=null,o=$("#select-group option:selected").val(),t=$("#select-group option:selected").data("name"),s=$("#select-group option:selected").data("members"),n=$("#select-group option:selected").data("members-short"),a=$("#textarea-solution").val(),r=$("#input-cost").val();switch(parseInt($("#select-instance option:selected").val())){case 1:e="cvrp1";break;case 2:e="cvrp2";break;case 3:e="cvrp3"}if(null==e)y("Alguma coisa saiu errado! Por favor, comunique o erro ao professor informando o código de erro.",1,60,10);else{var l=function(e,o,t){for(var s={success:!1,cost_evaluated:null,solution:null},n=o.replace(/\s+/g,"").trim().split(";"),a=0;a<n.length;a++){n[a]=n[a].split(",");for(var r=0;r<n[a].length;r++)if(n[a][r]=parseInt(n[a][r]),isNaN(n[a][r]))return y("A solução informada não está no formato correto! Leia as instruções acima para descobrir como formatar sua solução.",1,15,null),C(),s}s.solution="",n.join(";");for(a=0;a<n.length;a++)s.solution+=n[a].join(","),a+1!=n.length&&(s.solution+=";");var l=function(e){var a={num_vertices:0,num_vehicles:0,capacity:0,demands:null,coordinates:null};return $.ajax({url:"/assets/cvrp-cup/instances/"+e+".txt",async:!1,success:function(e){for(var o=e.split("\n"),t=0;t!=o.length;){if("#num_vertices"==o[t]){t++,a.num_vertices=parseInt(o[t]);break}t++}for(;t!=o.length;){if("#num_vehicles"==o[t]){t++,a.num_vehicles=parseInt(o[t]);break}t++}for(;t!=o.length;){if("#capacity"==o[t]){t++,a.capacity=parseInt(o[t]);break}t++}for(;t!=o.length;){if("#demands"==o[t]){t++;break}t++}a.demands=new Array(a.num_vertices);for(var s=0;s<a.num_vertices;s++){var n=o[t].replace(/\s+/g," ").trim().split(" ");a.demands[s]=parseInt(n[1]),t++}for(;t!=o.length;){if("#coordinates"==o[t]){t++;break}t++}a.coordinates=new Array(a.num_vertices);for(s=0;s<a.num_vertices;s++){n=o[t].replace(/\s+/g," ").trim().split(" ");a.coordinates[s]=new Array(2),a.coordinates[s][0]=parseFloat(n[1]),a.coordinates[s][1]=parseFloat(n[2]),t++}}}),a}(e);if(n.length<l.num_vehices)return y("O número de rotas não condiz com o número mínimo de rotas! Deveriam haver pelo menos <strong>"+l.num_vehicles+" rotas </strong>. Leia as instruções acima para descobrir como formatar sua solução.",1,15,null),C(),s;for(a=0;a<n.length;a++)if(n[a][0]!=n[a][n[a].length-1])return y("Rota número "+(a+1)+" inviável, o primeiro vértice deve ser igual ao último!",1,15,null),C(),s;for(var i=new Array(l.num_vertices).fill(!1),c=0;c<n.length;c++){var u=0;for(a=1;a<n[c].length-1;a++){if(n[c][a]>=l.num_vertices||n[c][a]<0)return y("Solução inviável! Na rota "+(c+1)+", o cliente "+n[c][a]+" não existe!",1,15,null),C(),s;if(i[n[c][a]])return y("Solução inviável! Na rota "+(c+1)+" o cliente "+n[c][a]+" é visitado mais de uma vez!",1,15,null),C(),s;if((u+=l.demands[n[c][a]])>l.capacity)return y("Solução inviável! Na rota "+(c+1)+" a capacidade do veículo é excedida!",1,15,null),C(),s;i[n[c][a]]=!0}}for(c=1;c<l.num_vertices;c++)if(!i[c])return y("Solução inviável! O cliente "+c+" nunca é visitado!",1,15,null),C(),s;var d=0;for(c=0;c<n.length;c++)for(a=0;a<n[c].length-1;a++){var m=l.coordinates[n[c][a]][0],v=l.coordinates[n[c][a]][1],p=l.coordinates[n[c][a+1]][0],f=l.coordinates[n[c][a+1]][1];d+=(g=m,h=v,_=p,b=f,Math.round(Math.sqrt(Math.pow(g-_,2)+Math.pow(h-b,2))))}var g,h,_,b;d!=t&&y("A solução informada possui valor <strong>"+d+"</strong>, mas foi informado "+t+". Note que iremos considerar o valor correto, mas isso pode indicar um bug em seu código.",2,15,null);return s.success=!0,s.cost_evaluated=d,$("#textarea-solution").removeClass("is-invalid"),s}(e,a,r);if(l.success&&$("#alert-successfully-sent").hasClass("d-none")){a=a.replace(/\n/g,"").replace(/\s/g,""),console.log(a);var i='Solution:\n{\n\t"solution": {\n\t\t"instance_name": "'+e+'",\n\t\t"group_id": '+o+',\n\t\t"group_name": "'+t+'",\n\t\t"group_members": "'+s+'",\n\t\t"group_members_short": "'+n+'",\n\t\t"time_stamp": "'+moment().format()+'",\n\t\t"solution_cost_user": '+r+',\n\t\t"solution_cost_evaluated": '+l.cost_evaluated+',\n\t\t"solution_user": "'+a+'",\n\t\t"solution": "'+l.solution+'"\n\t}\n}';$.ajax({type:"POST",url:"https://hooks.zapier.com/hooks/catch/5750378/o2ukzbb/",data:{message:i,group:o},success:function(){console.log("Sent!"),$("#alert-successfully-sent").removeClass("d-none"),setTimeout(function(){$("#alert-successfully-sent").addClass("d-none")},1e4),$(this).toggleClass("d-none"),$("#btn-sending").toggleClass("d-none")},error:function(){y("Não foi possível enviar sua solução. Por favor entre em contato com o professor para reportar o erro!",1,60,null),$(this).toggleClass("d-none"),$("#btn-sending").toggleClass("d-none")},dataType:"json"})}}}()},!1)});function y(e,o,t,s){var n=$('<div class="alert alert-'+(1==o?"danger":"warning")+' alert-dismissible fade show" role="alert"></div>').append("<strong>"+(1==o?"Erro":"Aviso")+(null!=s?" "+s:"")+":</strong> "+e).append('<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>');$("#container-alerts").append(n),setTimeout(function(){n.remove()},1e3*t)}function C(){$("#form-tsp-cup-submit").removeClass("was-validated"),$("#textarea-solution").hasClass("is-invalid")||$("#textarea-solution").addClass("is-invalid").removeClass("is-valid")}$("#alert-successfully-sent .close").on("click",function(e){return e.preventDefault(),$("#alert-successfully-sent").hasClass("d-none")||$("#alert-successfully-sent").addClass("d-none"),!1})});