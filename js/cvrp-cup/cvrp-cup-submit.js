$(document).ready(function(){var e=document.getElementsByClassName("needs-validation");Array.prototype.filter.call(e,function(e){e.addEventListener("submit",function(a){a.preventDefault(),a.stopPropagation(),e.classList.add("was-validated"),!0===e.checkValidity()&&function(){$(this).toggleClass("d-none"),$("#btn-sending").toggleClass("d-none"),$("#container-alerts").empty();var e=null,a=$("#select-group option:selected").val(),r=$("#select-group option:selected").data("name"),n=$("#select-group option:selected").data("members"),i=$("#select-group option:selected").data("members-short"),l=$("#textarea-solution").val(),u=$("#input-cost").val();switch(parseInt($("#select-instance option:selected").val())){case 1:e="cvrp1";break;case 2:e="cvrp2";break;case 3:e="cvrp3";break;case 4:e="cvrp4"}if(null==e)o("Alguma coisa saiu errado! Por favor, comunique o erro ao professor informando o código de erro.",1,60,10);else{var c=function(e,a,r){for(var n={success:!1,cost_evaluated:null,solution:null},i=a.replace(/\s+/g,"").trim().split(";"),l=0;l<i.length;l++){i[l]=i[l].split(",");for(var u=0;u<i[l].length;u++)if(i[l][u]=parseInt(i[l][u]),isNaN(i[l][u]))return o("A solução informada não está no formato correto! Leia as instruções acima para descobrir como formatar sua solução.",1,15,null),s(),n}n.solution="",i.join(";");for(var l=0;l<i.length;l++)n.solution+=i[l].join(","),l+1!=i.length&&(n.solution+=";");var c=function(e){var t={num_vertices:0,num_vehicles:0,capacity:0,demands:null,coordinates:null};return $.ajax({url:"/assets/cvrp-cup/instances/"+e+".txt",async:!1,success:function(e){for(var o=e.split("\n"),s=0;s!=o.length;){if("#num_vertices"==o[s]){s++,t.num_vertices=parseInt(o[s]);break}s++}for(;s!=o.length;){if("#num_vehicles"==o[s]){s++,t.num_vehicles=parseInt(o[s]);break}s++}for(;s!=o.length;){if("#capacity"==o[s]){s++,t.capacity=parseInt(o[s]);break}s++}for(;s!=o.length;){if("#demands"==o[s]){s++;break}s++}t.demands=new Array(t.num_vertices);for(var a=0;a<t.num_vertices;a++){var r=o[s].replace(/\s+/g," ").trim().split(" ");t.demands[a]=parseInt(r[1]),s++}for(;s!=o.length;){if("#coordinates"==o[s]){s++;break}s++}for(t.coordinates=new Array(t.num_vertices),a=0;a<t.num_vertices;a++)r=o[s].replace(/\s+/g," ").trim().split(" "),t.coordinates[a]=new Array(2),t.coordinates[a][0]=parseFloat(r[1]),t.coordinates[a][1]=parseFloat(r[2]),s++}}),t}(e);if(i.length<c.num_vehices)return o("O número de rotas não condiz com o número mínimo de rotas! Deveriam haver pelo menos <strong>"+c.num_vehicles+" rotas </strong>. Leia as instruções acima para descobrir como formatar sua solução.",1,15,null),s(),n;for(var l=0;l<i.length;l++)if(i[l][0]!=i[l][i[l].length-1])return o("Rota número "+(l+1)+" inviável, o primeiro vértice deve ser igual ao último!",1,15,null),s(),n;for(var d=new Array(c.num_vertices).fill(!1),m=0;m<i.length;m++)for(var v=0,l=1;l<i[m].length-1;l++){if(i[m][l]>=c.num_vertices||i[m][l]<0)return o("Solução inviável! Na rota "+(m+1)+", o cliente "+i[m][l]+" não existe!",1,15,null),s(),n;if(d[i[m][l]])return o("Solução inviável! Na rota "+(m+1)+" o cliente "+i[m][l]+" é visitado mais de uma vez!",1,15,null),s(),n;if((v+=c.demands[i[m][l]])>c.capacity)return o("Solução inviável! Na rota "+(m+1)+" a capacidade do veículo é excedida!",1,15,null),s(),n;d[i[m][l]]=!0}for(var m=1;m<c.num_vertices;m++)if(!d[m])return o("Solução inviável! O cliente "+m+" nunca é visitado!",1,15,null),s(),n;for(var p=0,m=0;m<i.length;m++)for(var l=0;l<i[m].length-1;l++){var f=c.coordinates[i[m][l]][0],g=c.coordinates[i[m][l]][1],b=c.coordinates[i[m][l+1]][0],h=c.coordinates[i[m][l+1]][1];console.log("p"+i[m][l]+" = ("+f+", "+g+")"),console.log("p"+i[m][l+1]+" = ("+b+", "+h+")"),console.log("distance(p1,p2) = "+t(f,g,b,h)),p+=t(f,g,b,h)}p!=r&&o("A solução informada possui valor <strong>"+p+"</strong>, mas foi informado "+r+". Note que iremos considerar o valor correto, mas isso pode indicar um bug em seu código.",2,15,null);return n.success=!0,n.cost_evaluated=p,$("#textarea-solution").removeClass("is-invalid"),n}(e,l,u);if(c.success&&$("#alert-successfully-sent").hasClass("d-none")){$("#alert-successfully-sent").removeClass("d-none"),setTimeout(function(){$("#alert-successfully-sent").addClass("d-none")},1e4);var d='<strong>Solution:</strong><br>{<br>\t"solution": {<br>\t\t"instance_name": "'+e+'",<br>\t\t"group_id": '+a+',<br>\t\t"group_name": "'+r+'",<br>\t\t"group_members": "'+n+'",<br>\t\t"group_members_short": "'+i+'",<br>\t\t"time_stamp": "'+moment().format()+'",<br>\t\t"solution_cost_user": '+u+',<br>\t\t"solution_cost_evaluated": '+c.cost_evaluated+',<br>\t\t"solution_user": "'+l+'",<br>\t\t"solution": "'+c.solution+'"<br>\t}<br>}';$("#input-email-msg").val(d),$("#input-email-title").val("[CVRP CUP] Grupo "+a),$("#form-test").submit()}}$(this).toggleClass("d-none"),$("#btn-sending").toggleClass("d-none")}()},!1)});function t(e,t,o,s){return Math.round(Math.sqrt(Math.pow(e-o,2)+Math.pow(t-s,2)))}function o(e,t,o,s){var a=$('<div class="alert alert-'+(1==t?"danger":"warning")+' alert-dismissible fade show" role="alert"></div>').append("<strong>"+(1==t?"Erro":"Aviso")+(null!=s?" "+s:"")+":</strong> "+e).append('<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>');$("#container-alerts").append(a),setTimeout(function(){a.remove()},1e3*o)}function s(){$("#form-tsp-cup-submit").removeClass("was-validated"),$("#textarea-solution").hasClass("is-invalid")||$("#textarea-solution").addClass("is-invalid").removeClass("is-valid")}$("#alert-successfully-sent .close").on("click",function(e){return e.preventDefault(),$("#alert-successfully-sent").hasClass("d-none")||$("#alert-successfully-sent").addClass("d-none"),!1})});