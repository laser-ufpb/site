$(document).ready(function(){var e=document.getElementsByClassName("needs-validation");Array.prototype.filter.call(e,function(o){o.addEventListener("submit",function(e){e.preventDefault(),e.stopPropagation(),o.classList.add("was-validated"),!0===o.checkValidity()&&function(){$(this).toggleClass("d-none"),$("#btn-sending").toggleClass("d-none"),$("#container-alerts").empty();var e=null,o=$("#select-group option:selected").val(),t=$("#select-group option:selected").data("name"),s=$("#select-group option:selected").data("members"),a=$("#select-group option:selected").data("members-short"),n=$("#textarea-solution").val(),r=$("#input-cost").val();switch(parseInt($("#select-instance option:selected").val())){case 1:e="cvrp1";break;case 2:e="cvrp2";break;case 3:e="cvrp3"}if(null==e)y("Alguma coisa saiu errado! Por favor, comunique o erro ao professor informando o código de erro.",1,60,10);else{var i=function(e,o,t){for(var s={success:!1,cost_evaluated:null,solution:null},a=o.replace(/\s+/g,"").trim().split(";"),n=0;n<a.length;n++){a[n]=a[n].split(",");for(var r=0;r<a[n].length;r++)if(a[n][r]=parseInt(a[n][r]),isNaN(a[n][r]))return y("A solução informada não está no formato correto! Leia as instruções acima para descobrir como formatar sua solução.",1,15,null),C(),s}s.solution="",a.join(";");for(n=0;n<a.length;n++)s.solution+=a[n].join(","),n+1!=a.length&&(s.solution+=";");var i=function(e){var n={num_vertices:0,num_vehicles:0,capacity:0,demands:null,coordinates:null};return $.ajax({url:"/assets/cvrp-cup/instances/"+e+".txt",async:!1,success:function(e){for(var o=e.split("\n"),t=0;t!=o.length;){if("#num_vertices"==o[t]){t++,n.num_vertices=parseInt(o[t]);break}t++}for(;t!=o.length;){if("#num_vehicles"==o[t]){t++,n.num_vehicles=parseInt(o[t]);break}t++}for(;t!=o.length;){if("#capacity"==o[t]){t++,n.capacity=parseInt(o[t]);break}t++}for(;t!=o.length;){if("#demands"==o[t]){t++;break}t++}n.demands=new Array(n.num_vertices);for(var s=0;s<n.num_vertices;s++){var a=o[t].replace(/\s+/g," ").trim().split(" ");n.demands[s]=parseInt(a[1]),t++}for(;t!=o.length;){if("#coordinates"==o[t]){t++;break}t++}n.coordinates=new Array(n.num_vertices);for(s=0;s<n.num_vertices;s++){a=o[t].replace(/\s+/g," ").trim().split(" ");n.coordinates[s]=new Array(2),n.coordinates[s][0]=parseFloat(a[1]),n.coordinates[s][1]=parseFloat(a[2]),t++}}}),n}(e);if(a.length<i.num_vehices)return y("O número de rotas não condiz com o número mínimo de rotas! Deveriam haver pelo menos <strong>"+i.num_vehicles+" rotas </strong>. Leia as instruções acima para descobrir como formatar sua solução.",1,15,null),C(),s;for(n=0;n<a.length;n++)if(a[n][0]!=a[n][a[n].length-1])return y("Rota número "+(n+1)+" inviável, o primeiro vértice deve ser igual ao último!",1,15,null),C(),s;for(var l=new Array(i.num_vertices).fill(!1),u=0;u<a.length;u++){var c=0;for(n=1;n<a[u].length-1;n++){if(a[u][n]>=i.num_vertices||a[u][n]<0)return y("Solução inviável! Na rota "+(u+1)+", o cliente "+a[u][n]+" não existe!",1,15,null),C(),s;if(l[a[u][n]])return y("Solução inviável! Na rota "+(u+1)+" o cliente "+a[u][n]+" é visitado mais de uma vez!",1,15,null),C(),s;if((c+=i.demands[a[u][n]])>i.capacity)return y("Solução inviável! Na rota "+(u+1)+" a capacidade do veículo é excedida!",1,15,null),C(),s;l[a[u][n]]=!0}}for(u=1;u<i.num_vertices;u++)if(!l[u])return y("Solução inviável! O cliente "+u+" nunca é visitado!",1,15,null),C(),s;var d=0;for(u=0;u<a.length;u++)for(n=0;n<a[u].length-1;n++){var m=i.coordinates[a[u][n]][0],v=i.coordinates[a[u][n]][1],p=i.coordinates[a[u][n+1]][0],f=i.coordinates[a[u][n+1]][1];d+=(g=m,h=v,_=p,b=f,Math.round(Math.sqrt(Math.pow(g-_,2)+Math.pow(h-b,2))))}var g,h,_,b;d!=t&&y("A solução informada possui valor <strong>"+d+"</strong>, mas foi informado "+t+". Note que iremos considerar o valor correto, mas isso pode indicar um bug em seu código.",2,15,null);return s.success=!0,s.cost_evaluated=d,$("#textarea-solution").removeClass("is-invalid"),s}(e,n,r);if(i.success&&$("#alert-successfully-sent").hasClass("d-none")){var l='Solution:\n{\n\t"solution": {\n\t\t"instance_name": "'+e+'",\n\t\t"group_id": '+o+',\n\t\t"group_name": "'+t+'",\n\t\t"group_members": "'+s+'",\n\t\t"group_members_short": "'+a+'",\n\t\t"time_stamp": "'+moment().format()+'",\n\t\t"solution_cost_user": '+r+',\n\t\t"solution_cost_evaluated": '+i.cost_evaluated+',\n\t\t"solution_user": "'+n+'",\n\t\t"solution": "'+i.solution+'"\n\t}\n}';$.ajax({type:"POST",url:"https://hooks.zapier.com/hooks/catch/5750378/o2ukzbb/",data:{message:l,group:o},success:function(){console.log("Sent!"),$("#alert-successfully-sent").removeClass("d-none"),setTimeout(function(){$("#alert-successfully-sent").addClass("d-none")},1e4)},error:function(){y("Não foi possível enviar sua solução. Por favor entre em contato com o professor para reportar o erro!",1,60,null)},dataType:"json"})}}$(this).toggleClass("d-none"),$("#btn-sending").toggleClass("d-none")}()},!1)});function y(e,o,t,s){var a=$('<div class="alert alert-'+(1==o?"danger":"warning")+' alert-dismissible fade show" role="alert"></div>').append("<strong>"+(1==o?"Erro":"Aviso")+(null!=s?" "+s:"")+":</strong> "+e).append('<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>');$("#container-alerts").append(a),setTimeout(function(){a.remove()},1e3*t)}function C(){$("#form-tsp-cup-submit").removeClass("was-validated"),$("#textarea-solution").hasClass("is-invalid")||$("#textarea-solution").addClass("is-invalid").removeClass("is-valid")}$("#alert-successfully-sent .close").on("click",function(e){return e.preventDefault(),$("#alert-successfully-sent").hasClass("d-none")||$("#alert-successfully-sent").addClass("d-none"),!1})});